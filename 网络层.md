## 概述

网络层的主要任务是==实现网络互连==，进而实现数据包在各网络之间的传输。

要实现网络层的任务，需要解决一下主要问题：

1. 网络层向运输层提供怎样的服务（“可靠传输”或“不可靠传输”）
2. 网络层寻址问题
3. 路由选择问题



因特网是目前全世界用户数量最多的互联网，它使用TCP/IP协议栈。

由于TCP/IP协议栈的网络层使用网络协议IP，它是整个协议的核心协议，所以在TCP/IP协议栈中网络层常常被称作网际层。所以我们通过学习TCP/IP协议栈的网际层来学习网络层的理论知识和时间技术。



## 网际层协议

IP协议，ARP协议，ICMP，IGMP....



## 网络层可以提供的两种服务



1. 面向连接的**虚电路服务**
   1. 由于TCP/IP体系结构的因特网的网际层提供的是最简单地，无连接的，尽最大努力交付的数据报服务，所以本章主要围绕因特网网际层如何传输IP数据报这个主题进行讨论。 
2. 无连接的**数据报服务**



![在这里插入图片描述](网络层.assets/20210323194547616.png)

>  什么是虚电路?和电路交换什么不同：
>
> 回答：虚电路是逻辑上的连接，和电路交换不同；电路交换是真正物理上的电路连接。



## IP数据报的发送和转发过程

IP数据报的发送和转发过程包含了两个部分：

- 主机发送IP数据报
  - 判断目的主机是否和自己在同一个网络中
    - 在一个网络中，则属于直接交付；
    - 若不在同一个网络中，则属于间接交付，传输给主机所在的网络的默认网关（路由器），由默认网关帮忙转发。
- 路由器转发发IP数据报
  1. 检查IP数据报首部是否出错
     1. 若出错，则直接丢失该IP数据报并通报给源主机；
     2. 若没有出错，则进行转发；
  2. 根据IP数据报的目的地址在路由器中查找匹配的条目
     1. 若找到匹配的条目，则转发给条目中的下一跳；
     2. 若找不到，则丢失该IP数据报并通报给源主机；

（忽略ARP协议来获取目的主机或路由器接口的MAC地址的过程以及以太网交换机自学习和转发的过程）



> 问题1：源主机如何知道目的主机是否与自己在同一个网络中？
>
> 用目的IP地址与自己子网掩码相于，得到的目的地址 如果做自己的网络地址不相等，说明不在同一个网络中。



> 问题2: 源主机如何知道路由器的存在呢？
>
> 回答：每个网络都有一个默认网关（默认路由器），当主机和其他网络的主机进行通信时，就见IP数据报传送给默认网关。
>
> 路由器中，一个接口就是一个IP地址。



下一跳：不是自己身上的接口，从自己出来要进入的端口。
